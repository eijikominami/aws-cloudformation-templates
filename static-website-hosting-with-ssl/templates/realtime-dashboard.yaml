AWSTemplateFormatVersion: 2010-09-09
Transform: AWS::Serverless-2016-10-31
Description: AWSCloudFormationTemplates/static-web-hosting creates an environment for static website hosting.

Parameters: 
  LogicalNamePrefix:
    Type: String
    Default: DefaultSecuritySettings
    AllowedPattern: .+
    Description: The custom prefix name [required]
  SNSForAlertArn:
    Type: String
    Default: '' 
  TagKey:
    Type: String
    Default: createdby
    AllowedPattern: .+
  TagValue:
    Type: String
    Default: aws:cloudformation:stack
    AllowedPattern: .+

Resources:
  # Kinesis Data Streams
  Kinesis:
    Type: 'AWS::Kinesis::Stream'
    Properties:
      Name: !Ref LogicalNamePrefix
      RetentionPeriodHours: 24
      # Server-Side Encryption
      StreamEncryption:
        EncryptionType: KMS
        KeyId: alias/aws/kinesis
      ShardCount: 200
      Tags:
        - Key: !Ref TagKey
          Value: !Ref TagValue
  CloudWatchAlarmKinesis:
    Type: 'AWS::Serverless::Application'
    Properties:
      Parameters:
        CustomAlarmName: !Ref LogicalNamePrefix
        SNSTopicArn: !Ref SNSForAlertArn
        KinesisStreamName: !Ref LogicalNamePrefix
        IteratorAgeMillisecondsThreshold: 30000
        # Number of Input Records (200000rps * 60sec)
        NumberOfPutRecordThreshold: 12000000
      NotificationARNs: 
        - !Ref SNSForAlertArn
      Location:
        ApplicationId: arn:aws:serverlessrepo:us-east-1:172664222583:applications/cloudwatch-alarm-about-kinesis-data-streams
        SemanticVersion: 1.1.8
      Tags:
        createdby: !Ref TagValue