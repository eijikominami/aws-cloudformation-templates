version: 0.2

phases:
  pre_build:
    commands:
      - export SEMANTIC_VERSION=`echo ${CODEBUILD_WEBHOOK_TRIGGER} | sed -r 's/tag\/v([0-9\.]+).*-rc(.*)/\1/'`
      - echo $SEMANTIC_VERSION
  build:
    commands:
      - aws serverlessrepo create-application-version --source-code-url https://github.com/eijikominami/aws-cloudformation-templates --application-id arn:aws:serverlessrepo:us-east-1:172664222583:applications/cloudwatch-alarm-about-apigateway --semantic-version ${SEMANTIC_VERSION} --template-url https://${BUCKET_NAME}.s3-ap-northeast-1.amazonaws.com/aws-cloudformation-templates/monitoring/apigateway.yaml --region us-east-1
      - aws serverlessrepo create-application-version --source-code-url https://github.com/eijikominami/aws-cloudformation-templates --application-id arn:aws:serverlessrepo:us-east-1:172664222583:applications/cloudwatch-alarm-about-codebuild --semantic-version ${SEMANTIC_VERSION} --template-url https://${BUCKET_NAME}.s3-ap-northeast-1.amazonaws.com/aws-cloudformation-templates/monitoring/codebuild.yaml --region us-east-1
      - aws serverlessrepo create-application-version --source-code-url https://github.com/eijikominami/aws-cloudformation-templates --application-id arn:aws:serverlessrepo:us-east-1:172664222583:applications/cloudwatch-alarm-about-dynamodb-throttle --semantic-version ${SEMANTIC_VERSION} --template-url https://${BUCKET_NAME}.s3-ap-northeast-1.amazonaws.com/aws-cloudformation-templates/monitoring/dynamodb-throttle.yaml --region us-east-1
      - aws serverlessrepo create-application-version --source-code-url https://github.com/eijikominami/aws-cloudformation-templates --application-id arn:aws:serverlessrepo:us-east-1:172664222583:applications/cloudwatch-alarm-about-dynamodb --semantic-version ${SEMANTIC_VERSION} --template-url https://${BUCKET_NAME}.s3-ap-northeast-1.amazonaws.com/aws-cloudformation-templates/monitoring/dynamodb.yaml --region us-east-1
      - aws serverlessrepo create-application-version --source-code-url https://github.com/eijikominami/aws-cloudformation-templates --application-id arn:aws:serverlessrepo:us-east-1:172664222583:applications/cloudwatch-alarm-about-ec2 --semantic-version ${SEMANTIC_VERSION} --template-url https://${BUCKET_NAME}.s3-ap-northeast-1.amazonaws.com/aws-cloudformation-templates/monitoring/ec2.yaml --region us-east-1  
      - aws serverlessrepo create-application-version --source-code-url https://github.com/eijikominami/aws-cloudformation-templates --application-id arn:aws:serverlessrepo:us-east-1:172664222583:applications/cloudwatch-alarm-about-events --semantic-version ${SEMANTIC_VERSION} --template-url https://${BUCKET_NAME}.s3-ap-northeast-1.amazonaws.com/aws-cloudformation-templates/monitoring/events.yaml --region us-east-1    
      - aws serverlessrepo create-application-version --source-code-url https://github.com/eijikominami/aws-cloudformation-templates --application-id arn:aws:serverlessrepo:us-east-1:172664222583:applications/cloudwatch-alarm-about-kinesis-data-streams --semantic-version ${SEMANTIC_VERSION} --template-url https://${BUCKET_NAME}.s3-ap-northeast-1.amazonaws.com/aws-cloudformation-templates/monitoring/kinesis.yaml --region us-east-1
      - aws serverlessrepo create-application-version --source-code-url https://github.com/eijikominami/aws-cloudformation-templates --application-id arn:aws:serverlessrepo:us-east-1:172664222583:applications/cloudwatch-alarm-about-lambda --semantic-version ${SEMANTIC_VERSION} --template-url https://${BUCKET_NAME}.s3-ap-northeast-1.amazonaws.com/aws-cloudformation-templates/monitoring/lambda.yaml --region us-east-1
      - aws serverlessrepo create-application-version --source-code-url https://github.com/eijikominami/aws-cloudformation-templates --application-id arn:aws:serverlessrepo:us-east-1:172664222583:applications/cloudwatch-alarm-about-natgateway --semantic-version ${SEMANTIC_VERSION} --template-url https://${BUCKET_NAME}.s3-ap-northeast-1.amazonaws.com/aws-cloudformation-templates/monitoring/natgateway.yaml --region us-east-1
      - aws serverlessrepo create-application-version --source-code-url https://github.com/eijikominami/aws-cloudformation-templates --application-id arn:aws:serverlessrepo:us-east-1:172664222583:applications/cloudwatch-alarm-about-sns --semantic-version ${SEMANTIC_VERSION} --template-url https://${BUCKET_NAME}.s3-ap-northeast-1.amazonaws.com/aws-cloudformation-templates/monitoring/sns.yaml --region us-east-1
      - aws serverlessrepo create-application-version --source-code-url https://github.com/eijikominami/aws-cloudformation-templates --application-id arn:aws:serverlessrepo:us-east-1:172664222583:applications/sns-topic --semantic-version ${SEMANTIC_VERSION} --template-url https://${BUCKET_NAME}.s3-ap-northeast-1.amazonaws.com/aws-cloudformation-templates/notification/sns.yaml --region us-east-1
      - aws serverlessrepo create-application-version --source-code-url https://github.com/eijikominami/aws-cloudformation-templates --application-id arn:aws:serverlessrepo:us-east-1:172664222583:applications/eventbridge-rules --semantic-version ${SEMANTIC_VERSION} --template-url https://${BUCKET_NAME}.s3-ap-northeast-1.amazonaws.com/aws-cloudformation-templates/notification/events.yaml --region us-east-1
      - aws serverlessrepo create-application-version --source-code-url https://github.com/eijikominami/aws-cloudformation-templates --application-id arn:aws:serverlessrepo:us-east-1:172664222583:applications/delete-resources-without-required-tags --semantic-version ${SEMANTIC_VERSION} --template-url https://${BUCKET_NAME}.s3-ap-northeast-1.amazonaws.com/aws-cloudformation-templates/security-config-rules/packaged.yaml --region us-east-1